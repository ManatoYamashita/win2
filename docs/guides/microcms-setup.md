# microCMS セットアップガイド

このドキュメントでは、WIN×ⅡプロジェクトでmicroCMSを使用するための設定手順を説明します。

## 1. microCMSアカウント作成

1. [microCMS公式サイト](https://microcms.io/)にアクセス
2. 「無料で始める」をクリックして新規アカウント登録
3. サービス名を入力（例: `win2`）
4. サービスドメインが自動生成されます（例: `win2.microcms.io`）

## 2. API作成

以下の2つのAPIを作成します。

### 2-1. categories API（カテゴリ）

**API ID**: `categories`
**API種別**: リスト形式

#### フィールド設定

| フィールドID | 表示名 | 種類 | 必須 | 説明 |
|------------|--------|------|------|------|
| `name` | カテゴリ名 | テキストフィールド | ✅ | カテゴリの表示名 |
| `description` | 説明 | テキストフィールド | - | カテゴリの説明文 |

#### 設定のポイント

- **コンテンツID**: microCMSの **コンテンツID** がURLのスラッグとして使用されます
  - コンテンツID作成時に英数字とハイフン のみを使用してください（例: `beauty`, `poker`）
  - コンテンツIDは後から変更できないため、慎重に設定してください
- **name**: カテゴリの日本語表示名（例: `美容`, `ポーカー`）

#### サンプルデータ

```
コンテンツID: beauty（作成時に設定、URLに使用）
カテゴリ名: 美容
説明: 美容に関する記事
```

---

### 2-2. blogs API（ブログ記事）

**API ID**: `blogs`
**API種別**: リスト形式

#### フィールド設定

| フィールドID | 表示名 | 種類 | 必須 | 説明 |
|------------|--------|------|------|------|
| `title` | タイトル | テキストフィールド | ✅ | 記事のタイトル |
| `content` | 本文 | リッチエディタ | ✅ | 記事の本文（HTML形式） |
| `thumbnail` | サムネイル画像 | 画像 | - | 記事のサムネイル |
| `category` | カテゴリ | コンテンツ参照 - categories | - | 参照先: `categories`（単一選択） |

#### 設定のポイント

- **コンテンツID**: microCMSの **コンテンツID** がURLのスラッグとして使用されます
  - コンテンツID作成時に英数字とハイフンのみを使用してください（例: `real-face`, `poker-strategy-2024`）
  - 推奨命名規則: `{topic}-{keyword}` または `{category}-{topic}-{year}` 形式
  - コンテンツIDは後から変更できないため、慎重に設定してください
- **title**: 記事のタイトル（SEOにも使用）
- **content**: リッチエディタで記事本文を作成。見出し、画像、リストなど自由に使用可能
- **thumbnail**: 1200x630px 推奨（OGP対応）
- **category**: 単一のカテゴリを選択（複数選択不可）
- **公開制御**: microCMS標準の `publishedAt` で公開/非公開を管理
  - 下書き保存時は公開日時を設定しない
  - 公開時に日時を設定（即時公開は現在日時、予約公開は未来日時）

#### 自動生成される項目

システム側で以下の項目が自動的に処理されます：

- **記事の抜粋**: `content` フィールドからHTMLタグを除去し、先頭150文字を自動抽出
- **SEOメタ情報**:
  - `metaTitle`: `title` フィールドの値を使用
  - `metaDescription`: 自動抽出した抜粋を使用
  - `ogImage`: `thumbnail` フィールドの画像を使用

#### サンプルデータ

```
コンテンツID: real-face（作成時に設定、URLに使用）
タイトル: 自宅で美容を試すだけで"謝礼あり"！...
本文: （リッチエディタで作成）
サムネイル: （画像をアップロード）
カテゴリ: 美容（beautycategoryを選択）
公開日時: 2025-10-25 17:46（公開時に設定）
```

#### 案件（Deal）情報について

**重要**: 案件情報はmicroCMSではなく、Google Sheets と Google Apps Script (GAS) で管理されています。

- 記事内で案件を紹介する場合は、本文の `content` フィールド内に案件情報を記載してください
- 案件への申込リンクは別途実装される機能で対応します
- 案件データの編集はGoogle Sheetsで行います（詳細は `docs/specs/google.md` を参照）

---

## 3. APIキーの取得

1. microCMSの管理画面で「サービス設定」→「APIキー」に移動
2. 「新規作成」をクリック
3. 以下の情報を入力:
   - **名前**: `WIN2 Production`（任意）
   - **権限**: `GET`（読み取り専用で十分）
4. 「作成」をクリック
5. 生成されたAPIキーをコピー

## 4. 環境変数の設定

プロジェクトルートの `.env.local` に以下を追加します。

```bash
# microCMS設定
MICROCMS_SERVICE_DOMAIN=your-service-domain  # 例: win2
MICROCMS_API_KEY=your-api-key-here
```

**注意**:
- `MICROCMS_SERVICE_DOMAIN` には `https://` や `.microcms.io` を含めず、サービス名のみを指定
- APIキーは絶対に公開しないこと（Gitにコミットしない）

## 5. 動作確認

環境変数を設定したら、開発サーバーを起動して動作確認します。

```bash
npm run dev
```

### 確認項目

- [ ] トップページ（`http://localhost:3000`）が表示される
- [ ] ブログ一覧（`/blog`）が表示される
- [ ] ブログ詳細（`/blog/[id]`）が表示される（コンテンツIDをURLに使用）
- [ ] カテゴリページ（`/category/[id]`）が表示される（コンテンツIDをURLに使用）
- [ ] サムネイル画像が正しく表示される
- [ ] 記事本文がHTMLとして正しく表示される
- [ ] カテゴリ情報が正しく表示される

## 6. トラブルシューティング

### エラー: `MICROCMS_SERVICE_DOMAIN is required`

- `.env.local` ファイルが正しく配置されているか確認
- 環境変数名のスペルミスがないか確認
- 開発サーバーを再起動

### 記事が表示されない

- microCMSの管理画面で記事が **公開** されているか確認（`publishedAt` が設定されているか）
- `publishedAt` が未来の日時になっていないか確認
- ブラウザのキャッシュをクリア

### 画像が表示されない

- Next.jsの `next.config.js` に microCMS のドメインが追加されているか確認

```javascript
// next.config.js
module.exports = {
  images: {
    domains: ['images.microcms-assets.io'],
  },
};
```

---

## 付録: 推奨ワークフロー

### 新規記事の作成フロー

1. **カテゴリの作成**（初回のみ）
   - 必要なカテゴリを `categories` APIで作成
   - コンテンツIDは英数字とハイフンのみ使用（例: `beauty`, `poker`）

2. **ブログ記事の作成**
   - `blogs` APIで新規記事を作成
   - コンテンツIDを慎重に設定（例: `real-face`, `poker-strategy-2024`）
   - リッチエディタで本文を執筆
   - サムネイル画像をアップロード（1200x630px推奨）
   - カテゴリを1つ選択
   - プレビューで確認
   - 公開日時を設定して公開

3. **動作確認**
   - サイトで記事が正しく表示されるか確認
   - サムネイル画像が正しく表示されるか確認
   - カテゴリページから記事が表示されるか確認

### コンテンツ管理のベストプラクティス

- **コンテンツID命名規則**: `{topic}-{keyword}` または `{category}-{topic}-{year}` 形式を推奨
  - 例: `real-face`, `poker-beginner-tips-2024`, `beauty-skincare-2025`
  - 英数字とハイフンのみ使用
  - 後から変更不可のため慎重に設定
- **画像サイズ**: サムネイルは 1200x630px 推奨（OGP対応）
- **カテゴリ選択**: 記事ごとに1つのカテゴリを選択（複数選択不可）
- **本文作成**: リッチエディタで見出し（h2, h3）、画像、リストを効果的に使用
- **公開管理**: 下書き保存と公開の切り替えは `publishedAt` で管理

---

## サポート

microCMSの詳細なドキュメントは[公式ドキュメント](https://document.microcms.io/)を参照してください。
