# CTAショートコード使用ガイド（クライアント様向け）

## 概要

WIN×Ⅱでは、ブログ記事内にアフィリエイト案件への申込ボタンを簡単に設置できる「CTAショートコード」機能を提供しています。

このガイドでは、ショートコードの使い方と案件の登録方法を説明します。

## CTAボタンとは

CTA（Call To Action）ボタンは、読者が記事で紹介されている案件に申し込むためのボタンです。

- オレンジ色のグラデーションボタン
- クリックすると自動的にトラッキング情報を付与してASPサイトへ誘導
- 会員/非会員のクリックログを自動記録
- 成果発生時のキャッシュバック計算に必要

## 案件の登録（Google Sheets）

### 手順

1. **Google Sheetsの「案件マスタ」シートを開く**

2. **必要な情報を2つだけ入力**

   | A列 | B列 |
   |-----|-----|
   | アフィリエイトURL | 案件ID |
   | https://px.a8.net/svt/ejp?a8mat=XXXXX | a8-rakuten-card |

   - **A列（アフィリエイトURL）**: ASPから取得したアフィリエイトリンクをそのまま貼り付け
   - **B列（案件ID）**: 任意の一意なID（英数字とハイフンのみ、例: `a8-rakuten-card`）

3. **Enterキーを押して確定**

4. **自動入力を確認**

   以下の項目が自動的に入力されます：

   | C列 | D列 | E列 | F列 | G列 |
   |-----|-----|-----|-----|-----|
   | 案件名 | ASP名 | 報酬額 | キャッシュバック率 | 有効/無効 |
   | 楽天カード（自動取得） | A8.net（自動判定） | 0 | 0.2 | TRUE |

   - **C列（案件名）**: URLのページタイトルから自動取得（失敗時は「不明なタイトル」）
   - **D列（ASP名）**: URLパターンから自動判定（A8.net, AFB, もしも, バリューコマース）
   - **E-G列**: デフォルト値が自動入力

### 案件IDの命名ルール

- **英数字とハイフン（-）のみ使用**
- **小文字推奨**
- **わかりやすい名前**

良い例：
- `a8-rakuten-card`
- `afb-u-next`
- `moshimo-amazon-prime`

悪い例：
- `案件001`（日本語不可）
- `deal 001`（スペース不可）
- `DEAL-001`（大文字でも可だが小文字推奨）

## ブログ記事でのショートコード使用

### 基本的な使い方

microCMSのリッチエディタで記事を書く際、CTAボタンを設置したい場所に以下のショートコードを入力します：

```
[CTA:案件ID]
```

### 具体例

#### 例1: 楽天カードの紹介記事

```
楽天カードは年会費無料で高還元率のクレジットカードです。
ポイントが貯まりやすく、楽天市場での買い物がさらにお得になります。

[CTA:a8-rakuten-card]

入会特典として5,000ポイントがもらえるキャンペーン実施中です！
```

#### 例2: 複数案件の紹介

```
おすすめのクレジットカード3選をご紹介します。

## 1. 楽天カード

年会費無料で高還元率！

[CTA:a8-rakuten-card]

## 2. エポスカード

海外旅行保険が自動付帯！

[CTA:afb-epos-card]

## 3. リクルートカード

ポイント還元率1.2%！

[CTA:moshimo-recruit-card]
```

### 実際の表示

ショートコード `[CTA:a8-rakuten-card]` は、自動的に以下のようなボタンに変換されます：

```
┌─────────────────────────────────────┐
│  この案件に申し込む →              │ ← オレンジ色のグラデーションボタン
└─────────────────────────────────────┘
```

### 注意事項

1. **ショートコードは大文字で `[CTA:...]`**
   - `[cta:...]` （小文字）は動作しません

2. **案件IDは事前にGoogle Sheetsに登録**
   - 未登録の案件IDを使用すると、ボタンは表示されますがクリック時にエラーが発生します

3. **半角文字で入力**
   - `[CTA：a8-rakuten-card]` （全角コロン）は動作しません
   - `[CTA:a8-rakuten-card]` （半角コロン）が正しい

4. **前後に改行を入れる**
   - ボタンの前後に空行があると見やすくなります

## トラッキングの仕組み

### クリック時の動作

1. 読者がCTAボタンをクリック
2. サーバーが以下の情報を記録：
   - 日時
   - 会員ID（非会員の場合はguest:UUID）
   - 案件名
   - 案件ID
   - イベントID（クリック毎に一意のUUID）
3. Google Sheetsの「クリックログ」に自動保存
4. トラッキングパラメータ付きのURLへ自動リダイレクト：
   ```
   https://px.a8.net/svt/ejp?a8mat=XXXXX&id1={会員ID}&eventId={イベントID}
   ```

### 成果発生時の処理

1. ASPで成果発生
2. 成果CSVをダウンロード
3. Google Sheetsの「成果CSV_RAW」シートに貼り付け
4. 毎日3:10に自動集計（GAS）
5. 「成果データ」シートに出力
6. 会員がマイページで確認可能

## よくある質問

### Q1: ショートコードが表示されてしまう

**A:** 以下を確認してください：

- ショートコードが `[CTA:案件ID]` の形式か（大文字・半角）
- 案件IDがGoogle Sheetsの「案件マスタ」に登録されているか
- ブラウザのコンソールでエラーメッセージを確認

### Q2: ボタンは表示されるがクリックできない

**A:** 以下を確認してください：

- Google Sheetsの「案件マスタ」でG列（有効/無効）が `TRUE` になっているか
- アフィリエイトURL（A列）が正しいか
- ブラウザのコンソールでエラーメッセージを確認

### Q3: 案件名が「不明なタイトル」になる

**A:** アフィリエイトURLからページタイトルを自動取得できなかった場合に表示されます。

**対処方法:**
1. Google Sheetsの「案件マスタ」を開く
2. C列（案件名）を手動で編集
3. わかりやすい案件名を入力（例: "楽天カード"）

### Q4: 同じ案件を複数の記事で紹介できますか？

**A:** はい、できます。同じ案件IDを複数の記事で使用できます。

```
記事1: [CTA:a8-rakuten-card]
記事2: [CTA:a8-rakuten-card]  ← 同じ案件IDを使用可能
記事3: [CTA:a8-rakuten-card]
```

### Q5: 1つの記事に複数のCTAボタンを設置できますか？

**A:** はい、できます。同じ案件でも異なる案件でも設置できます。

```
[CTA:a8-rakuten-card]

...（中略）...

[CTA:a8-rakuten-card]  ← 同じ案件を再度紹介

...（中略）...

[CTA:afb-epos-card]    ← 別の案件を紹介
```

## サポート対応ASP

現在、以下のASPに対応しています：

- **A8.net** - URLに `a8.net` が含まれる場合に自動判定
- **AFB（アフィリエイトB）** - URLに `afi-b.com` または `afb.com` が含まれる場合
- **もしもアフィリエイト** - URLに `moshimo.com` が含まれる場合
- **バリューコマース** - URLに `valuecommerce.com` が含まれる場合

その他のASPの場合、D列（ASP名）が空欄になりますので、手動で入力してください。

## トラブルシューティング

### エラー: 「指定された案件が見つかりません」

**原因:** 案件IDがGoogle Sheetsに登録されていない

**解決方法:**
1. Google Sheetsの「案件マスタ」を開く
2. B列（案件ID）に該当のIDがあるか確認
3. ない場合は新規登録

### エラー: 「この案件は現在ご利用いただけません」

**原因:** 案件が無効化されている

**解決方法:**
1. Google Sheetsの「案件マスタ」を開く
2. G列（有効/無効）が `FALSE` になっている
3. `TRUE` に変更

## まとめ

1. **案件登録**: Google Sheetsに「アフィリエイトURL」と「案件ID」の2つだけ入力
2. **記事作成**: microCMSで記事を書き、`[CTA:案件ID]` を挿入
3. **自動処理**: ボタン表示、クリック記録、トラッキング、成果集計が自動化

これで、簡単にアフィリエイト案件の紹介ができます！
