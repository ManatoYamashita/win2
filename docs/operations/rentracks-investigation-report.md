# レントラックス（Rentracks）成果トラッキング実装方法調査報告書

**作成日**: 2025-11-23
**調査範囲**: Web公開情報のみ（管理画面実機確認前）
**ステータス**: Phase 1 - 情報収集待ち
**次のアクション**: レントラックス担当者への問い合わせ

---

## エグゼクティブサマリー

レントラックス（Rentracks）について、徹底的に調査した結果、**A8.net方式（手動CSV）に近い実装が適している**ものの、**重要な差異**が存在します。レントラックスは広告主側のタグ設置が必要で、メディア側ではカスタムパラメータの直接制御ができません。

### 重要な結論

- **実装可否**: ✅ 実装可能（広告主との連携が成功した場合）
- **推奨方式**: A8.net改良型（手動CSV + 広告主連携）
- **実装難易度**: 高（広告主との連携が必須）
- **前提条件**: レントラックス担当者への問い合わせと広告主側のタグ設置

---

## 1. レントラックスの基本情報

### 1.1 正式名称と位置づけ

- **正式名称**: Rentracks（レントラックス）
- **運営会社**: 株式会社レントラックス
- **ASPタイプ**: クローズド型アフィリエイトサービス（招待制）
- **管理画面URL**: 登録後に担当者から提供される（公開情報なし）

### 1.2 公式情報の入手制限

レントラックスはクローズド型ASPのため、以下の情報は**会員登録後にのみ提供**されます:

- API仕様書
- 管理画面マニュアル
- 成果レポートCSVフォーマット
- パラメータトラッキング機能の有無

**参考リンク**:
- [株式会社レントラックス公式サイト](https://www.rentracks.co.jp/)
- [クローズド型の会員制ASP・Rentracksの評判や使い方を解説](https://www.onamae.com/column/affiliate/57/)

---

## 2. カスタムパラメータ機能の調査結果

### 2.1 トラッキング方式

レントラックスは**コンバージョンタグ（成果タグ）方式**を採用しています。A8.netのParameter Trackingとは根本的に異なる仕組みです。

#### 2.1.1 トラッキングタグの構造

```javascript
<script type="text/javascript">
(function(){
  function loadScriptRTCV(callback){
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.src = 'https://www.rentracks.jp/js/itp/rt.track.js?t=' + (new Date()).getTime();
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  loadScriptRTCV(function(){
    _rt.sid = [顧客番号];
    _rt.pid = [プログラムID];
    _rt.price = [売上金額];
    _rt.reward = -1;
    _rt.cname = "";
    _rt.ctel = "";
    _rt.cemail = "";
    _rt.cinfo = '[成果特定に必要な識別記号（UTF-8でURLエンコード）]';
    rt_tracktag();
  });
}());
</script>
```

**重要パラメータ**:
- `_rt.cinfo`: 成果特定用の識別記号（**会員IDやイベントIDを格納可能**）

**参考リンク**:
- [レントラックスのITPタグ設置方法について（Welcartフォーラム）](https://www.welcart.com/community/forums/topic/レントラックスのitpタグ設置方法について)

### 2.2 A8.netとの重要な違い

| 項目 | A8.net | Rentracks |
|------|--------|-----------|
| **パラメータ付与場所** | アフィリエイトリンク（URL） | コンバージョンページ（JavaScriptタグ） |
| **パラメータ制御** | メディア側で自由に追加可能 | **広告主側タグ設置が必要** |
| **成果データ取得** | Parameter Tracking Report CSV | 管理画面レポート（詳細不明） |
| **API提供** | なし（Media Member向け） | 不明（要問い合わせ） |

### 2.3 WIN×Ⅱでの実装上の課題

**問題点**:
1. **広告主がタグを設置する必要がある**: メディア（WIN×Ⅱ）側では`_rt.cinfo`に会員IDやイベントIDを埋め込めません
2. **アフィリエイトリンクにパラメータを追加できない**: A8.netの`?id1={memberId}&id2={eventId}`方式が使えません
3. **成果マッチングが困難**: 広告主がタグに会員IDを埋め込まない限り、WIN×Ⅱ側で成果と会員を紐付けられません

---

## 3. 成果データ取得方法

### 3.1 管理画面レポート機能

レントラックスは**リアルタイム成果確認機能**を提供していますが、具体的なCSVエクスポート手順は公開されていません。

**確認できる情報**:
- クリック数
- コンバージョン率
- 収益
- 成果レポート（詳細な分析可能）

**参考リンク**:
- [レントラックスとは？料金や特徴について解説](https://asp240322.com/レントラックスのログイン画面の概要とは？ユー/)
- [レントラックス完全ガイド](https://blogrou.com/rentracks/)

### 3.2 CSV エクスポート機能

**調査結果**: 公開情報にCSVエクスポート機能の記載なし

**推測される実装**:
- 管理画面にCSVダウンロードボタンが存在する可能性が高い（他ASPと同様）
- フォーマットは**要実機確認**

### 3.3 API提供状況

**調査結果**: 公式API仕様書は非公開

**第三者ツール連携事例**:
- [Databeat Explore](https://help.data-be.at/ja/rentracks%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%82%92%E7%99%BB%E9%8C%B2%E3%81%99%E3%82%8B): 1日1回早朝にデータ取得（過去31日分）
- アルミナ: CSV手動インポート方式

**結論**: AFB方式の自動ポーリングは**API仕様確認まで不可**

**参考リンク**:
- [Rentracksアカウントを登録する（Databeat Explore）](https://help.data-be.at/ja/rentracks%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%82%92%E7%99%BB%E9%8C%B2%E3%81%99%E3%82%8B)
- [アルミナのASPアドオンの解説](https://alumina-ai.jp/function/asp.html)

---

## 4. 必要データ列の確認

以下のデータが取得できるかは**実機確認が必須**です:

| 項目 | 必須度 | 備考 |
|------|--------|------|
| 会員ID（id1相当） | **必須** | `_rt.cinfo`に埋め込まれている場合のみ取得可能 |
| イベントID（id2相当） | **必須** | `_rt.cinfo`に埋め込まれている場合のみ取得可能 |
| 成果ステータス | 必須 | 未確定/確定/否認 |
| 案件名 | 必須 | - |
| 報酬額 | 必須 | - |
| 成果発生日時 | 推奨 | - |
| 成果確定日時 | 推奨 | - |
| 注文ID（orderId相当） | 推奨 | 重複チェック用 |

---

## 5. 実装パターン提案

### 5.1 前提条件と制約事項

**重要な制約**:
1. **広告主との連携が必須**: コンバージョンタグに`_rt.cinfo`として会員ID・イベントIDを埋め込む設定が必要
2. **アフィリエイトリンクでのパラメータ制御は不可**: A8.net方式は利用できない
3. **成果レポートCSVフォーマットは未確認**: 実装前に管理画面で確認が必須

### 5.2 推奨実装パターン: **A8.net改良型（手動CSV + 広告主連携）**

#### 5.2.1 システム構成図

```
┌─────────────────────────────────────────────────────┐
│                    Rentracks管理画面                │
│              成果レポート CSVダウンロード           │
└──────────────────────┬──────────────────────────────┘
                       │ 週1回または月1回
                       ↓
         ┌──────────────────────────┐
         │  Google Sheets          │
         │  「成果CSV_RAW」シート   │
         └──────────────────────────┘
                       │
                       ↓
              ┌────────────────┐
              │  GAS処理       │ ← メニュー「成果処理」→「成果をクリックログに記録」
              └────────────────┘
                       │
                       ↓
         ┌──────────────────────────┐
         │  Google Sheets          │
         │  「クリックログ」シート  │ ← F列・G列を更新
         └──────────────────────────┘
                       │
                       ↓
           ┌────────────────────┐
           │  Member MyPage     │ ← /mypage/history
           └────────────────────┘
```

#### 5.2.2 実装手順

**Phase 1: 広告主との連携設定（最重要）**

1. レントラックス担当者に連絡
2. 広告主（案件提供元）にコンバージョンタグ設置を依頼
3. `_rt.cinfo`に以下のフォーマットで埋め込むよう設定:
   ```javascript
   _rt.cinfo = encodeURIComponent('{memberId}|{eventId}');
   ```
4. 広告主側の実装確認とテスト実施

**Phase 2: GASコード拡張**

既存の`code.gs.js`（v4.0.0）に**Rentracks用ヘッダー候補**を追加:

```javascript
const HEADER_CANDIDATES = {
  memberId: [
    // A8.net用
    'パラメータ(id1)', 'パラメータid1', 'パラメータ（id1）', 'パラメータ（ID1）', 'パラメータID1',
    'id1', 'memberid', 'member_id', '会員id', '会員ＩＤ', '会員ｉｄ',
    // Rentracks用（要確認）
    '成果特定情報', 'cinfo', 'カスタム情報'
  ],
  eventId: [
    // A8.net用
    'パラメータ(id2)', 'パラメータid2', 'パラメータ（id2）', 'パラメータ（ID2）', 'パラメータID2',
    'id2', 'eventid', 'event_id', 'イベントid', 'イベントＩＤ',
    // Rentracks用（要確認）
    '成果特定情報', 'cinfo', 'カスタム情報'
  ],
  dealName: [
    'プログラム名', '案件名', '商品名', '広告名', 'program', 'dealname', 'offer', 'サービス名', '広告主名'
  ],
  status: [
    'ステータス名', '承認状況', 'ステータス', '状態', 'status'
  ]
};
```

**重要**: Rentracks成果レポートCSVのヘッダー名は**実機確認後に正確な名称を追加**してください。

**Phase 3: Google Sheets「成果CSV_RAW」へのデータ貼り付け**

A8.net方式と同様:
1. Rentracks管理画面にログイン
2. 成果レポートCSVをダウンロード
3. Google Sheets「成果CSV_RAW」にヘッダー行を含めて貼り付け
4. GASメニュー「成果処理」→「成果をクリックログに記録」を実行

**Phase 4: クリックログのマッチング処理**

既存のGAS処理がそのまま動作します:
- `_rt.cinfo`に埋め込まれた`{memberId}|{eventId}`を抽出
- クリックログのB列（memberId）、E列（eventId）と照合
- F列（案件名）、G列（ステータス）を更新

### 5.3 代替案: AFB型（自動ポーリング）

**条件**: Rentracks APIが提供されている場合のみ実装可能

**実装イメージ**:
```typescript
// app/api/cron/sync-rentracks-conversions/route.ts
export async function POST(request: NextRequest) {
  // CRON_SECRET検証
  // Rentracks API ポーリング
  // Google Sheets「成果CSV_RAW」に書き込み
}
```

**前提条件**:
1. Rentracks API仕様書の入手
2. API認証情報（Partner ID、API Key）の取得
3. `_rt.cinfo`に会員ID・イベントIDが含まれていること

**参考**: `app/api/cron/sync-afb-conversions/route.ts`と同じ設計

---

## 6. 既存GASコードへの追加項目リスト

### 6.1 必須追加項目

**ファイル**: `google-spread-sheet/code.gs.js`

#### 6.1.1 HEADER_CANDIDATES拡張

```javascript
const HEADER_CANDIDATES = {
  memberId: [
    // 既存のA8.net用候補...
    // ↓ Rentracks用を追加（実機確認後に正確な名称を入力）
    '成果特定情報', 'cinfo', 'カスタム情報', 'tracking_info'
  ],
  eventId: [
    // 既存のA8.net用候補...
    // ↓ Rentracks用を追加（実機確認後に正確な名称を入力）
    '成果特定情報', 'cinfo', 'カスタム情報', 'tracking_info'
  ],
  // dealName, status も同様に追加
};
```

#### 6.1.2 成果特定情報のパース処理（オプション）

`_rt.cinfo`が`{memberId}|{eventId}`形式の場合、パース処理を追加:

```javascript
function parseRentracksInfo_(cinfoValue) {
  if (!cinfoValue || typeof cinfoValue !== 'string') return { memberId: '', eventId: '' };
  const parts = cinfoValue.split('|');
  return {
    memberId: parts[0] || '',
    eventId: parts[1] || ''
  };
}
```

### 6.2 環境変数追加（API連携の場合）

**ファイル**: `.env.example`

```bash
# Rentracks - Future implementation
RENTRACKS_PARTNER_ID=your_rentracks_partner_id_here
RENTRACKS_API_KEY=your_rentracks_api_key_here
```

---

## 7. 実装前の確認事項チェックリスト

### 7.1 レントラックス担当者への問い合わせ事項

- [ ] 1. 成果レポートCSVエクスポート機能の有無と操作方法
- [ ] 2. CSVフォーマット（ヘッダー名と各カラムの内容）
- [ ] 3. `_rt.cinfo`に会員ID・イベントIDを埋め込む設定が可能か
- [ ] 4. 広告主への設定依頼方法とサポート体制
- [ ] 5. API提供の有無とドキュメント入手方法
- [ ] 6. 成果ステータスの値（未確定/確定/否認の表記方法）

### 7.2 広告主との調整事項

- [ ] 1. コンバージョンタグへの`_rt.cinfo`埋め込み可否
- [ ] 2. 埋め込みフォーマット（`{memberId}|{eventId}`推奨）
- [ ] 3. テスト環境での動作確認
- [ ] 4. 本番反映スケジュール

### 7.3 技術実装前の確認

- [ ] 1. レントラックス管理画面アクセス権の取得
- [ ] 2. 成果レポートCSVの実データサンプル取得
- [ ] 3. GASコード修正箇所の特定
- [ ] 4. テスト用の成果データでマッチング処理確認

---

## 8. リスクと注意事項

### 8.1 高リスク項目

1. **広告主との連携が必須**
   - 広告主がタグ設置に協力しない場合、実装不可
   - 広告主側のエンジニアリソースが必要

2. **CSVフォーマットの不確定性**
   - A8.netのような標準的なParameter Trackingがない
   - ヘッダー名が広告主ごとに異なる可能性

3. **成果特定情報の取得失敗**
   - `_rt.cinfo`に会員ID・イベントIDが含まれない場合、マッチング不可
   - 既存のクリックログとの紐付けができない

### 8.2 推奨される対策

1. **レントラックス担当者との密接な連携**
   - 実装前に詳細な仕様確認
   - テスト環境での動作検証

2. **段階的な実装**
   - Phase 1: 手動CSV方式の確立
   - Phase 2: API連携の検討（可能な場合）

3. **フォールバックプラン**
   - 成果特定情報が取得できない場合のマニュアル照合フロー
   - タイムスタンプと案件名ベースの推定マッチング

---

## 9. 実装スケジュール提案

### Phase 1: 情報収集（2週間）

- レントラックス担当者への問い合わせ
- 管理画面アクセス権取得
- 成果レポートCSVサンプル取得

### Phase 2: 広告主連携（2-4週間）

- 広告主へのコンバージョンタグ設置依頼
- テスト環境での動作確認
- 本番反映

### Phase 3: GASコード実装（1週間）

- HEADER_CANDIDATES拡張
- マッチング処理テスト
- 運用マニュアル作成

### Phase 4: 運用開始（1週間）

- 週次CSV手動取得フローの確立
- モニタリングと改善

---

## 10. まとめと推奨事項

### 10.1 実装可否判定

| 実装方式 | 可否 | 条件 |
|---------|------|------|
| **A8.net改良型（手動CSV）** | ✅ 実装可能 | 広告主との連携が成功した場合 |
| **AFB型（自動ポーリング）** | ⚠️ 条件付き可能 | API提供があり、広告主連携も成功した場合 |
| **A8.net型（URLパラメータ）** | ❌ 実装不可 | レントラックスの仕様上不可 |

### 10.2 推奨アクション

1. **最優先**: レントラックス担当者への問い合わせ（本報告書の「7.1 問い合わせ事項」を参照）
2. **次ステップ**: 広告主との連携可否の確認
3. **実装判断**: 上記2つが成功した場合のみ、GASコード拡張を実施

### 10.3 最終所感

レントラックスは、A8.netやAFBと比較して**実装難易度が高い**ASPです。広告主との連携が必須という点で、メディア側の制御範囲を超えた調整が必要になります。

しかし、適切な手順を踏めば実装可能です。本報告書の実装提案に従って、段階的に進めることを推奨します。

---

## 参考リンク

- [株式会社レントラックス公式サイト](https://www.rentracks.co.jp/)
- [クローズド型の会員制ASP・Rentracks評判や使い方](https://www.onamae.com/column/affiliate/57/)
- [レントラックスのITPタグ設置方法（Welcartフォーラム）](https://www.welcart.com/community/forums/topic/レントラックスのitpタグ設置方法について)
- [Rentracksアカウントを登録する（Databeat Explore）](https://help.data-be.at/ja/rentracks%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%82%92%E7%99%BB%E9%8C%B2%E3%81%99%E3%82%8B)
- [アルミナのASPアドオンの解説](https://alumina-ai.jp/function/asp.html)
- [レントラックスとは？料金や特徴について解説](https://asp240322.com/レントラックスのログイン画面の概要とは？ユー/)
- [レントラックス完全ガイド](https://blogrou.com/rentracks/)
