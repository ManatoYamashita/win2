# AccessTrade API - 概要

**最終更新日:** 2025-01-04
**実装優先度:** Phase 3（24点/40点）
**実装ステータス:** 🔍 調査中

---

## 目次

1. [AccessTradeとは](#accesstradeとは)
2. [WIN×ⅡでのAccessTrade統合目的](#winⅱでのaccesstrade統合目的)
3. [利用可能なAPI機能](#利用可能なapi機能)
4. [カスタムトラッキングパラメータ](#カスタムトラッキングパラメータ)
5. [実装アーキテクチャ](#実装アーキテクチャ)
6. [評価スコア詳細](#評価スコア詳細)
7. [実装時の注意点](#実装時の注意点)
8. [参考リンク](#参考リンク)

---

## AccessTradeとは

### サービス概要

**AccessTrade（アクセストレード）** は、株式会社インタースペースが運営する老舗ASPで、以下の特徴があります：

- **設立:** 2001年
- **運営会社:** 株式会社インタースペース（東証一部上場）
- **特徴:** 金融・ゲーム・Eコマース案件に強い
- **強み:** 高単価案件多数、独占案件あり

### WIN×Ⅱでの利用シーン

1. **金融商品案件**
   - FX口座開設（高単価: 10,000円〜30,000円）
   - クレジットカード発行
   - 証券口座開設

2. **オンラインゲーム案件**
   - スマホゲームアプリインストール
   - PCゲーム登録

3. **Eコマース案件**
   - 大手ECサイト
   - 定期購入商品

---

## WIN×ⅡでのAccessTrade統合目的

### 主要目標

1. **個別成果の自動取得**
   - 成果レポートAPIによる定期的なデータ取得
   - 手動CSV貼り付け作業の自動化

2. **メンバー別トラッキング**
   - カスタムパラメータ `a8` の利用
   - クリックログとの自動照合

3. **高単価案件のキャッシュバック**
   - 金融案件の高額報酬を活用
   - 20%キャッシュバックの提供

### 期待される効果

- **運用工数削減:** 手動CSV操作の廃止（月間1-2時間削減）
- **高単価案件の活用:** 金融・ゲーム案件による会員満足度向上
- **精度向上:** カスタムパラメータによる正確なメンバー識別

---

## 利用可能なAPI機能

### AccessTrade API一覧

AccessTradeは以下のAPIを提供しています：

| API名 | 機能 | WIN×Ⅱでの利用 | ステータス |
|-------|------|--------------|-----------|
| **成果レポートAPI** | 成果データ取得 | ✅ **メイン利用** | 利用可能 |
| 広告主検索API | 案件情報検索 | ⏸️ 今後検討 | 利用可能 |
| リンク生成API | アフィリエイトリンク生成 | ⏸️ 今後検討 | 利用可能 |

### 成果レポートAPIの主要機能

**エンドポイント:**
```
GET https://h.accesstrade.net/api/v1/reports/orders
```

**認証方式:** APIキー（ヘッダー: `Authorization: Bearer {API_KEY}`）

**取得可能なデータ:**
- 成果ID（Order ID）
- 成果発生日時
- 報酬額
- 承認状況（承認/非承認/保留）
- カスタムパラメータ `a8`（**メンバーID照合に使用**）
- 広告主情報
- 商品名

**APIの特徴:**
- ✅ カスタムパラメータ `a8` 対応
- ✅ 日付範囲指定での絞り込み
- ✅ ページング対応（100件/ページ）
- ⚠️ レート制限: 要確認（公式ドキュメント参照）

**リクエストパラメータ:**
| パラメータ | 必須 | 説明 | 例 |
|-----------|------|------|-----|
| `from_date` | ✅ | 検索開始日（YYYY-MM-DD） | `2025-01-01` |
| `to_date` | ✅ | 検索終了日（YYYY-MM-DD） | `2025-01-31` |
| `status` | ❌ | ステータスフィルタ（approved/pending/rejected） | `approved` |
| `page` | ❌ | ページ番号（デフォルト: 1） | `1` |
| `count` | ❌ | 1ページあたりの件数（デフォルト: 20、最大: 100） | `100` |

**レスポンス形式:** `application/json`

```json
{
  "orders": [
    {
      "orderId": "AT-12345678",
      "orderDate": "2025-01-03T14:30:00+09:00",
      "commission": 15000,
      "status": "approved",
      "a8": "member-a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "merchantName": "Example FX",
      "productName": "FX口座開設"
    }
  ],
  "pagination": {
    "currentPage": 1,
    "totalPages": 5,
    "totalCount": 450
  }
}
```

---

## カスタムトラッキングパラメータ

### `a8` パラメータとは

AccessTradeの **a8パラメータ** は、アフィリエイトリンクに付与できるカスタムパラメータで、クリック時の情報を記録できます。

#### 基本仕様

| 項目 | 詳細 |
|------|------|
| **パラメータ名** | `a8` |
| **最大文字数** | 255文字 |
| **使用可能文字** | 半角英数字、ハイフン（-）、アンダースコア（_） |
| **設定方法** | アフィリエイトリンクに `&a8={value}` を追加 |
| **取得方法** | 成果レポートAPI の `a8` フィールド |

#### WIN×Ⅱでの利用方法

```
# クリック時にメンバーIDをa8に設定
https://h.accesstrade.net/sp/cc?rk={広告主ID}&af={サイトID}&a8={memberId}

例:
a8=member-a1b2c3d4-e5f6-7890-abcd-ef1234567890
a8=guest:550e8400-e29b-41d4-a716-446655440000
```

**データフロー:**
1. ユーザーが案件をクリック → `a8={memberId}` 付きリンクを生成
2. Google Sheets「クリックログ」に記録（日時, memberId, 案件名, eventId=a8）
3. AccessTradeで成果発生
4. 成果レポートAPIで成果取得 → `a8` フィールドに memberId が格納
5. クリックログと照合 → メンバー識別 → キャッシュバック計算

---

## 実装アーキテクチャ

### データフロー

```
[1. ユーザークリック]
    ↓
[2. /api/track-click]
    - a8={memberId} 付きリンク生成
    - Google Sheets「クリックログ」に記録（eventId=a8）
    ↓
[3. AccessTrade管理画面]
    - 成果発生・承認処理
    ↓
[4. 定期ポーリング（30分間隔推奨）]
    - Vercel Cron Job: /api/cron/accesstrade-sync
    - 成果レポートAPI呼び出し（過去24時間の成果取得）
    ↓
[5. 成果データ処理]
    - JSONパース
    - a8パラメータとクリックログ照合
    - メンバーID識別
    ↓
[6. Google Sheets書き込み]
    - 「成果CSV_RAW」に追記
    - 重複チェック（orderId）
    ↓
[7. GAS自動処理（毎日3:10）]
    - キャッシュバック計算（報酬 × 20%）
    - 「成果データ」シート出力
    ↓
[8. メンバーダッシュボード]
    - /mypage/history でキャッシュバック履歴表示
```

### 実装ファイル構成（予定）

```
lib/
├── accesstrade-api.ts            # API統合ロジック
│   ├── fetchOrderReport()        # 成果レポート取得
│   └── parseOrderReportJSON()    # JSON → 型変換

app/api/cron/accesstrade-sync/
└── route.ts                      # 定期同期Cronジョブ

types/
└── accesstrade.ts                # 型定義
    ├── OrderReportRequest
    ├── OrderReportResponse
    └── Order
```

### Cron Job設定

**Vercel Cron（vercel.json）:**

```json
{
  "crons": [
    {
      "path": "/api/cron/accesstrade-sync",
      "schedule": "*/30 * * * *"
    }
  ]
}
```

**実行頻度:** 30分間隔（1日48回）

---

## 評価スコア詳細

**総合スコア: 24/40点（Phase 3推奨）**

| 評価項目 | 配点 | 獲得点 | 理由 |
|---------|------|--------|------|
| **自動化レベル** | 10点 | 6点 | 成果レポートAPI、ポーリング必須（30分間隔推奨） |
| **会員別トラッキング精度** | 10点 | 9点 | `a8` パラメータで高精度対応 |
| **実装難易度** | 5点 | 3点 | APIキー認証、比較的シンプル |
| **ドキュメント品質** | 5点 | 3点 | 公式ドキュメント有り、サンプルコード少ない |
| **ビジネス価値** | 4点 | 4点 | 金融・ゲーム案件の高単価報酬 |
| **レスポンス速度** | 3点 | 1点 | ポーリング必須（30分間隔） |
| **エラーハンドリング** | 3点 | 2点 | レート制限要確認、基本的なエラーコード提供 |
| **その他** | - | -4点 | Phase 2完了後の実装推奨（優先度調整） |

### 実装優先度の判断

**Phase 3推奨の理由:**
1. **ValueCommerceと類似実装** - Phase 2の経験を活かせる
2. **カスタムトラッキング対応** - `a8` パラメータで高精度
3. **Phase 2完了後** - 実装パターンの確立後に着手

---

## 実装時の注意点

### 1. API認証

**APIキーの取得:**
1. AccessTrade管理画面にログイン
2. 「ツール」→「API設定」
3. APIキーを発行・コピー

**環境変数設定:**
```bash
# .env.local
ACCESSTRADE_API_KEY=your_api_key_here

# Vercel
vercel env add ACCESSTRADE_API_KEY production
```

### 2. レート制限

**公式ドキュメントで確認が必要:**
- リクエスト数/日の制限
- エラー時のリトライ戦略

**推奨対策:**
- 30分間隔ポーリング（1日48回）
- 指数バックオフでのリトライ
- エラーログ監視

### 3. 金融案件の特殊処理

**成果承認までの期間が長い:**
- FX口座開設: 30-90日
- クレジットカード: 60-90日
- 証券口座: 30-60日

**対応策:**
- ステータス「保留」での表示
- 承認後のメール通知
- キャッシュバック予定額の表示

### 4. 高単価報酬の管理

**報酬額が10,000円以上の案件が多い:**
- キャッシュバック額も2,000円以上
- 不正利用の監視強化
- メンバー認証の厳格化

---

## Phase 3実装計画（仮）

### Step 1: API仕様確認（2-3日）

1. AccessTrade公式ドキュメント精査
   - 成果レポートAPIの詳細仕様
   - レート制限
   - エラーコード一覧

2. テストアカウントでのAPI動作確認
   - サンプルリクエスト送信
   - レスポンス構造の確認

### Step 2: 実装（5-7日）

1. API統合ロジック実装（`lib/accesstrade-api.ts`）
2. a8パラメータ照合処理
3. Cronジョブ設定（`/api/cron/accesstrade-sync/route.ts`）
4. エラーハンドリング・リトライロジック

### Step 3: テスト・デプロイ（3-5日）

1. ローカル環境でのテスト
2. テストアカウントでの実運用テスト
3. 本番デプロイ
4. 1週間の動作監視

---

## 参考リンク

### 公式リンク

- [AccessTrade公式サイト](https://www.accesstrade.ne.jp/)
- [AccessTrade APIドキュメント](https://www.accesstrade.ne.jp/api/)（要ログイン）
- [AccessTrade サポート](https://support.accesstrade.net/)

### WIN×Ⅱ関連ドキュメント

- [ASP統合プロジェクト概要](./README.md)
- [ASP比較レポート](./asp-comparison-report.md)
- [ValueCommerce実装ガイド](./valuecommerce/order-api-guide.md)（参考実装）

---

## まとめ

### 現在のステータス

🔍 **調査中** - Phase 2完了後に実装開始判断

### 次のアクション

1. **Phase 2完了** - ValueCommerce運用開始
2. **API仕様確認** - 公式ドキュメント精査
3. **Phase 3開始** - ValueCommerceの実装パターンを流用

### 判断基準

**Phase 3実装を開始する条件:**
- ✅ Phase 2（ValueCommerce）の運用が安定
- ✅ カスタムトラッキング（a8）の動作確認完了
- ✅ レート制限が実用的な範囲内

**実装の優先度:**
- Phase 3候補の中では**最優先**（24点、カスタムトラッキング対応）
- もしもアフィリエイトと同点だが、APIドキュメントが充実

---

_Last Updated: 2025-01-04_
_Document Version: 1.0.0_
_Maintained by: WIN×Ⅱ Development Team_
